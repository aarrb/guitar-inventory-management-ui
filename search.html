<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Guitars</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <header>
        <h1>Guitar Inventory Management</h1>
        <nav>
            <a href="about.html">About</a>
            <a href="add.html">Add</a>
            <a href="search.html">Search</a>
        </nav>
    </header>

    <form id="searchForm">
        <div class="form-group">
            <label for="serialSearch">Serial Number:</label>
            <input id="serialSearch" type="text" name="serial">
        </div>
        <div class="form-group">
            <label for="builderSearch">Builder:</label>
            <input id="builderSearch" type="text" name="builder">
        </div>
        <div class="form-group">
            <label for="modelSearch">Model:</label>
            <input id="modelSearch" type="text" name="model">
        </div>
        <div class="form-group">
            <label for="typeSearch">Type:</label>
            <input id="typeSearch" type="text" name="type">
        </div>
        <div class="form-group">
            <label for="backWoodSearch">Back wood:</label>
            <input id="backWoodSearch" type="text" name="backWood">
        </div>
        <div class="form-group">
            <label for="topWoodSearch">Top wood:</label>
            <input id="topWoodSearch" type="text" name="topWood">
        </div>
        <div id="searchButtonDiv">
        <button id="searchButton" type="button" onclick="searchGuitars()">Search</button>
        </div>
    </form>

    <table id="resultsTable">
        <thead>
            <tr>
                <th>Serial number</th>
                <th>Price</th>
                <th>Builder</th>
                <th>Model</th>
                <th>Type</th>
                <th>Back Wood</th>
                <th>Top Wood</th>
            </tr>
        </thead>
        <tbody>

        </tbody>

    <script>
        let host = "http://localhost:8080";

        async function searchGuitars() {
            var serialValue = document.getElementById('serialSearch').value;
            var builderValue = document.getElementById('builderSearch').value;
            var modelValue = document.getElementById('modelSearch').value;
            var typeValue = document.getElementById('typeSearch').value;
            var backWoodValue = document.getElementById('backWoodSearch').value;
            var topWoodValue = document.getElementById('topWoodSearch').value;
            var resultsTable = document.getElementById('resultsTable').getElementsByTagName('tbody')[0];
            resultsTable.innerHTML = ''; // Clear previous results

            // Construct the query URL
            var queryURL = `${host}/search?` +
                `serialNumber=${encodeURIComponent(serialValue)}&` +
                `builder=${encodeURIComponent(builderValue)}&` +
                `model=${encodeURIComponent(modelValue)}&` +
                `type=${encodeURIComponent(typeValue)}&` +
                `backWood=${encodeURIComponent(backWoodValue)}&` +
                `topWood=${encodeURIComponent(topWoodValue)}`;

            try {
                let response = await fetch(queryURL);
                if (response.ok) {
                    let guitars = await response.json();
                    // Add the filtered guitars to the table
                    guitars.forEach(function (guitar) {
                        var row = resultsTable.insertRow();
                        Object.values(guitar).forEach(function (text) {
                            var cell = row.insertCell();
                            cell.textContent = text;
                        });
                    });
                } else {
                    alert("Error fetching data: " + response.statusText);
                }
            } catch (error) {
                alert("Something went wrong. Please try again or contact the customer support team.");
                console.error('Error:', error.message);
            }
        }
    </script>
</body>

</html>